{%extends "layout.html"%}
{%block css%}
<link rel = "stylesheet" href="{{url_for('static',filename = 'css/bootstrap.min.css')}}">
{%endblock%}
{%block content%}
<div class = "home">
    <h1 class = "logo"> Lista de itens </h1>
    <div class = "menu_crud">
      <strong><nav>

          	<div class = "control-group col-md-8">
            	<table  class="table table-striped table-bordered" name="tabela" id="tabela" >
					<thead>
						<tr>
							<td data-name = "product_id"> ID </td>
							<td data-name = "product_name"> Nome </td>
             				<td data-name = "product_esqt"> Em Estoque </td>
            				<td data-name = "product_price"> Preço </td>
							<td> Opções </td>
						</tr>
					</thead>
					<tbody>
					{%for row in dados%}
						<tr class = "sc-product-item">
						{%for col in row%}
							<td>{{ col }}</td>
						{%endfor%}
							<div class = "buttons">
								<td><a href = "update_item/{{row[0]}}"> Alterar </a></td>
								<td><a href = "viewone_item/{{row[0]}}"> Ver </a></td>
								<td><a href = "delete_item/{{row[0]}}"> Deletar </td>
                                <td><button class="btn btn-success my-cart-btn" data-id = "{{row[0]}}" data-name = "{{row[1]}}" data-quantity = 1 data-price = {{row[3]}} data-image = "{{ url_for('static',filename = 'img/dori.jpeg') }}">Add to cart</button></td>
							</div>
						</tr>
					{%endfor%}
					</tbody>
				</table>
    		</div>
            <div class = "col-md-4 control-group">
                <div style="float: right; cursor: pointer;">
                    <span class="glyphicon glyphicon-shopping-cart my-cart-icon"><span class="badge badge-notify my-cart-badge"></span></span>
                </div>
                </form>
            </div>

    </div>
</div>
{%endblock%}
{%block js%}

<script src="{{url_for('static',filename = 'js/jquery.mycart.min.js')}}"></script>
<script type="text/javascript">

  $(document).ready(function() {

    var goToCartIcon = function($addTocartBtn){
      var $cartIcon = $(".my-cart-icon");
      var $image = $('<img width="30px" height="30px" src="' + $addTocartBtn.data("image") + '"/>').css({"position": "fixed", "z-index": "999"});
      $addTocartBtn.prepend($image);
      var position = $cartIcon.position();
      $image.animate({
        top: position.top,
        left: position.left
      }, 500 , "linear", function() {
        $image.remove();
      });
    }

    var options = {
      currencySymbol: '$',
      classCartIcon: 'my-cart-icon',
      classCartBadge: 'my-cart-badge',
      classProductQuantity: 'my-product-quantity',
      classProductRemove: 'my-product-remove',
      classCheckoutCart: 'my-cart-checkout',
      affixCartIcon: true,
      showCheckoutModal: true,
      numberOfDecimals: 2,
      cartItems: [],
      clickOnAddToCart: function($addTocart){
        console.log($addTocart)
        goToCartIcon($addTocart);
      },
      afterAddOnCart: function(products, totalPrice, totalQuantity) {
        console.log("afterAddOnCart", products, totalPrice, totalQuantity);
      },
      clickOnCartIcon: function($cartIcon, products, totalPrice, totalQuantity) {
        console.log("cart icon clicked", $cartIcon, products, totalPrice, totalQuantity);
      },
      checkoutCart: function(products, totalPrice, totalQuantity) {
        var checkoutString = "Total Price: " + totalPrice + "\nTotal Quantity: " + totalQuantity;
        checkoutString += "\n\n id \t name \t summary \t price \t quantity \t image path";
        $.each(products, function(){
          checkoutString += ("\n " + this.id + " \t " + this.name + " \t " + this.summary + " \t " + this.price + " \t " + this.quantity + " \t " + this.image);
        });
        //$.post("{{ url_for('pedidos.add_pedidos') }}",cartItems).done().fail().always()
        console.log("checking out", products, totalPrice, totalQuantity);
      },
      getDiscountPrice: function(products, totalPrice, totalQuantity) {
        console.log("calculating discount", products, totalPrice, totalQuantity);
        return totalPrice * 0.5;
      }
    };
    
      // Initialize the leaveStep event
      $(".my-cart-btn").myCart(options);

  }); 
</script>
{%endblock%}